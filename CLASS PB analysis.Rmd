---
title: "CLASS analysis"
author: "BVD"
date: "4/11/2019"
output: pdf_document
---

```{r message=FALSE, warning=FALSE}
#load("~/hmi_data_1_10_19")
#load("~/Physics_Equity/hmifall2018_m10_better")
#load("~/Documents/LA Postdoc stuff copy/RData/LASSO/Denver-Chico_collaboration/Physics_Equity_new/hmifall2018_m10_better")
load("~/pb_data")
load("~/all_class")
library(ltm)
library(itemanalysis)
library(psych)
library(tidyr)
library("ggplot2")
library(gvlma)
library("HLMdiag")
library("DHARMa")
library("car") #for the Levene test which we will not discuss here
library("Matrix")
library(mitools)
library(stargazer)
library(lme4)
library(nlme)
library(mice)
library(mitml)
library(multcomp)
library(foreach)
library(ggplot2)
library(stringr)
library(dplyr)  #I load dplyr last because some of its functions (select) will be masked by plyr and it is a PITA to debug
library(kableExtra)
plot_col <- c('#66c2a5', '#fc8d62', '#8da0cb')
#cbbpalette <- c('#000000','#E69F00','#56B4E9')
cbbpalette <- c( "#009E73", "#e79f00", "#9ad0f3", "#0072B2", "#D55E00", 
    "#CC79A7","#000000", "#F0E442") #colorblind and grayscale friendly.
```

Combine data

```{r}
pre_data <- as.data.frame(pb_data[c(2:4,6:7,9,11:31,33,35:41,43)], drop=false)
post_data <- as.data.frame(pb_data[c(46:48,50:51,53,55:75,77,79:85,87)], drop=false)
names(pre_data) <- c("1","2","3","5","6","8","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","32","34","35","36","37","38","39","40","42")
names(post_data) <- c("1","2","3","5","6","8","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","32","34","35","36","37","38","39","40","42")
all_data <- rbind(pre_data,post_data)
```

Item analysis
```{r}
#item.analysis_pre <- itemanalysis2(data=pre_data, options=c(1,2,3,4,5),ngroup=37,correction=TRUE)
#item.analysis_post <- itemanalysis2(data=post_data, options=c(1,2,3,4,5),ngroup=37,correction=TRUE)
item.analysis_all <- itemanalysis2(data=all_data, options=c(1,2,3,4,5),ngroup=37,correction=TRUE)
pbserial <- as.data.frame(item.analysis_all[["plots"]][[1]][["plot_env"]][["dist.disc"]])
names(pbserial) <- c("SD","D","N","A","SA")
#item.analysis_all$plots[[1]] #these are interesting. Similar to item difficulty plots
#item.analysis_all$plots[[2]]
#item.analysis_all$plots[[3]]
#item.analysis_all$plots[[4]]
#item.analysis_all$plots[[5]]
#item.analysis_all$plots[[6]]
#item.analysis_all$plots[[7]]
```

plot
Item analysis
```{r}
multi.hist(pbserial,xlim=c(-1,1))

```